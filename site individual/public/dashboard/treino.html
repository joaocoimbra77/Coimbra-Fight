<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coimbra-Fight | Adicionar Treino</title>
    <link rel="stylesheet" href="dashboards.css">
</head>

<body>
    <header>
        <div class="layout">
            <div>
                <img class="img_layout" src="../imagens/Coimbra fight (1).png" alt="">
            </div>
            <div class="ola">
                <h3>Olá, <span id="b_usuario">usuário</span></h3>
            </div>
            <div class="btn-dash"><a href="dash.html">Desempenho</a>
            </div>
            <div class="btn-dash"><a href="treino.html" style="text-decoration: underline; color: #ffbd00;">Adicionar
                    Treino</a></div>
            <div class="btn-sair" onclick="limparSessao()"><a href="../index.html">Sair</a></div>
        </div>
    </header>

    <div class="main">
        <h1 class="titulo">Registrar Treino:</h1><br>
        <p class="text-inicial">Insira as informações solicitadas a baixo para ter acesso a nossa DashBoard e monitorar
            seu desempenho no boxe:</p>

        <div class="campos">
            <h4>Selecione o mês que deseja:</h4>
            <div class="falha" id="erro_mes"></div><br>
            <select id="slcMes">
                <option value="#">Selecione...</option>
                <option value="01">Janeiro</option>
                <option value="02">Fevereiro</option>
                <option value="03">Março</option>
                <option value="04">Abril</option>
                <option value="05">Maio</option>
                <option value="06">Junho</option>
                <option value="07">Julho</option>
                <option value="08">Agosto</option>
                <option value="09">Setembro</option>
                <option value="10">Outubro</option>
                <option value="11">Novembro</option>
                <option value="12">Dezembro</option>
            </select><br>
            <h4>informe a quantidade de dias de treino nesse mês:</h4>
            <div class="falha" id="erro_dias"></div><br> <input type="number" id="iptDias"><br><br>
            <h4>Informe a quantidade de Horas de treino nesse mês:</h4>
            <div class="falha" id="erro_horas"></div><br> <input type="number" id="iptHoras"><br><br><br><br>
            <button id="btn-registro" onclick="registrar()">Registrar</button>
        </div>
    </div>
</body>
<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    var idVar = sessionStorage.ID_USUARIO;
    
    function registrar() {
        var erro = 0;
        var mesVar = Number(slcMes.value);
        var treinoVar = Number(iptDias.value);
        var horasVar = Number(iptHoras.value);
        erro_mes.innerHTML = '';
        erro_dias.innerHTML = '';
        erro_horas.innerHTML = '';

        if (slcMes.value == '#') {
            erro_mes.innerHTML = 'Selecione um mês que deseja inserir as informações.';
            erro++;
        }
        if (iptDias.value % 1 != 0 || iptDias.value <= 0 || iptDias.value > 30) {
            erro_dias.innerHTML = 'Insira um quantidade de dias maior que 0 e até 30 dias.';
            erro++;
        }
        if (iptHoras.value % 1 != 0 || iptHoras.value <= 0) {
            erro_horas.innerHTML = 'Insira uma quantidade de horas maior que zero';
            erro++;
        }
        if (erro == 0) {
            fetch("/treino/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    mesServer: mesVar,
                    treinoServer: treinoVar,
                    horasServer: horasVar,
                    idServer: idVar
                }),
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {

                
                        setTimeout(() => {
                            window.location = "./dash.html";
                        }, "2000");

                        limparFormulario();
                        finalizarAguardar();
                    } else {
                        throw "Houve um erro ao tentar realizar o registro!";
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });

            return false;
        }
    }

</script>

</html>